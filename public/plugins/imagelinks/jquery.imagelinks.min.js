!function(o){"use strict";function t(t){if(this.options={selector:"*",mouseEvents:["click","dblclick","mousedown","mouseup"],usePolyfillIf:function(){if("Microsoft Internet Explorer"==navigator.appName){if(null!=navigator.userAgent.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/)){if(parseFloat(RegExp.$1)<11)return!0}}return!1}},t){var i=this;o.each(t,function(o,t){i.options[o]=t})}this.options.usePolyfillIf()&&this.register_mouse_events()}function i(o,t){this.container=null,this.config=null,this.controls={},this.hotSpots=[],this.popover=!1,this.popoverTemplate=null,this.popoverCloseManual=!1,this.popoverClosePopover=!1,this.imgWidth=0,this.imgHeight=0,this.zindex=4,this.hotSpotSetup=!1,this.id=s++,this.ready=!1,this.init(o,t)}t.initialize=function(o){return null==t.singleton&&(t.singleton=new t(o)),t.singleton},t.prototype.register_mouse_events=function(){o(document).on(this.options.mouseEvents.join(" "),this.options.selector,function(t){if("none"==o(this).css("pointer-events")){var i=o(this).css("display");o(this).css("display","none");var e=document.elementFromPoint(t.clientX,t.clientY);return i?o(this).css("display",i):o(this).css("display",""),t.target=e,o(e).trigger(t),!1}return!0})},t.initialize({selector:".imgl-popover"});var e=function(){function o(){}return o.prototype.css2json=function(o){var t={};if(!o)return t;if(o instanceof CSSStyleDeclaration)for(var i in o)o[i].toLowerCase&&(t[o[i].toLowerCase()]=o[o[i]]);else if("string"==typeof o){o=o.split(";");for(var i in o){var e=o[i].split(":");2==e.length&&(t[e[0].toLowerCase().trim()]=e[1].trim())}}return t},o.prototype.isMobile=function(o){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(o)},o.prototype.animationEvent=function(){var o=document.createElement("fakeelement"),t={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in t)if(void 0!==o.style[i])return t[i]},o}(),s=0;i.prototype={VERSION:"1.4.3",defaults:{theme:"imgl-default",popover:!0,popoverTemplate:"<div class='imgl-popover'><div class='imgl-close'></div><div class='imgl-arrow'></div><div class='imgl-content'></div></div>",popoverPlacement:"top",popoverShowTrigger:"hover",popoverHideTrigger:"leave",popoverShowClass:null,popoverHideClass:null,hotSpotBelowPopover:!0,hotSpots:[],hotSpotSetup:!1,mobile:!1,onLoad:null},init:function(o,t){this.container=o,this.config=t,this.checkAnimation(),this.destroy(),this.applyImage()},create:function(){this.applyDOM(),this.applyHandlers(),this.applyPopoverSupport(),this.applyHotSpots(),this.updateHotSpots(),"function"==typeof this.config.onLoad&&this.config.onLoad.call(this),this.ready=!0},checkAnimation:function(){var o=!this.config.mobile&&this.util().isMobile(navigator.userAgent);(void 0==this.util().animationEvent()||o)&&(this.config.popoverShowClass=null,this.config.popoverHideClass=null)},applyImage:function(){if(this.container.is("img")){this.container.get(0).onload=o.proxy(function(o){this.ready&&this.updateLayout()},this);var t=this.container.attr("src");if(t){var i=new Image;i.onload=o.proxy(function(o){this.imgWidth=i.width,this.imgHeight=i.height,this.create()},this),i.onerror=o.proxy(function(o){console.error("Cannot load image '"+t+"'")},this),i.src=t}else console.error("Cannot load image, the parameter 'image' must be defined")}else console.error("Cannot load image, the container should be an 'img' element")},applyDOM:function(){this.container.wrap("<div class='imgl'></div>"),this.container.wrap("<div class='imgl-img'></div>"),this.controls.$img=this.container.closest(".imgl-img"),this.controls.$main=this.container.closest(".imgl"),this.controls.$img.detach().css({top:-9999,left:-9999,width:0,position:"absolute"}),this.controls.$img.appendTo("body"),setTimeout(o.proxy(function(){this.controls.$img.detach().removeAttr("style"),this.controls.$img.prependTo(this.controls.$main)},this),1),this.controls.$view=o("<div class='imgl-view'></div>"),this.controls.$view.addClass(this.config.theme).attr("id",this.getUID("imgl")),this.config.hotSpotSetup&&this.controls.$view.addClass("imgl-hotspot-setup").attr("tabindex",1),this.controls.$hotspots=o("<div class='imgl-hotspots'></div>"),this.controls.$view.append(this.controls.$hotspots),this.controls.$main.append(this.controls.$view)},resetDOM:function(){this.controls.$view.remove(),this.container.unwrap(".imgl-img"),this.container.unwrap(".imgl")},applyHandlers:function(){this.config.hotSpotSetup&&(this.controls.$view.on("click.imgl",o.proxy(this.onViewClick,this)),this.controls.$view.on("keydown.imgl",o.proxy(this.onViewKeyDown,this)),this.controls.$view.on("keyup.imgl",o.proxy(this.onViewKeyUp,this))),this.controls.$img.on("animationstart.imgl MSAnimationStart.imgl webkitAnimationStart.imgl",o.proxy(this.onAnimationStart,this)),o(window).on("load.imgl-"+this.id,o.proxy(this.onLoad,this)),o(window).on("resize.imgl-"+this.id,o.proxy(this.onResize,this))},resetHandlers:function(){this.controls.$view.off("click.imgl"),this.controls.$view.off("keydown.imgl"),this.controls.$view.off("keyup.imgl"),o(window).off("load.imgl-"+this.id),o(window).off("resize.imgl-"+this.id)},applyHotSpots:function(){for(var t=JSON.parse(JSON.stringify(this.config.hotSpots)),i=0,e=t.length;i<e;i++){var s=t[i];if(s.className?s.$el=o("<div class='imgl-hotspot-custom "+s.className+"'></div>"):s.imageUrl?s.$el=o("<div class='imgl-hotspot-custom'></div>"):s.$el=o("<div class='imgl-hotspot'></div>"),s.imageUrl){var n="style='";(s.imageWidth||s.imageHeight)&&(n=n+(s.imageWidth?"width:"+s.imageWidth+"px;":"")+(s.imageHeight?"height:"+s.imageHeight+"px;":"")),n+="'";var r=o("<div class='imgl-hotspot-image'></div>");s.$image=o("<img src='"+s.imageUrl+"' alt=''"+n+">"),s.$el.append(r.append(s.$image))}if(s.link){r=o("<div class='imgl-hotspot-link'></div>").append("<a href='"+s.link+"' target='"+(s.linkNewWindow?"_blank":"_self")+"' rel='nofollow'>");s.$el.append(r)}if(s.content){r=o("<div class='imgl-hotspot-data'></div>").append(s.content);s.$el.append(r)}if("boolean"!=typeof s.popoverLazyload&&(s.popoverLazyload=!0),"boolean"!=typeof s.popoverShow&&(s.popoverShow=!1),s.id=this.getUID("hotspot"),s.$el.attr("id",s.id),s.$popover=null,s.visible=!0,"function"==typeof this.config.hotSpots[i].popoverContent&&(s.popoverContent=this.config.hotSpots[i].popoverContent),s.popoverContent||s.popoverSelector){for(var p=(l=this.config.popoverShowTrigger.trim().split(" ")).length;p--;){"click"==(a=l[p])?(s.$el.on("click.imgl",o.proxy(this.onHotSpotClick,this,s)),s.$el.on("touchstart.imgl",o.proxy(this.onHotSpotClick,this,s)),s.$el.on("touchend.imgl",o.proxy(this.onHotSpotTouchEnd,this,s))):"hover"==a&&(s.$el.on("mouseenter.imgl",o.proxy(this.onHotSpotEnter,this,s)),s.$el.on("touchstart.imgl",o.proxy(this.onHotSpotClick,this,s)),s.$el.on("touchend.imgl",o.proxy(this.onHotSpotTouchEnd,this,s)))}var l;for(p=(l=this.config.popoverHideTrigger.trim().split(" ")).length;p--;){var a;"click"==(a=l[p])?(s.$el.on("click.imgl",o.proxy(this.onPopoverHide,this,s)),s.$el.on("touchstart.imgl",o.proxy(this.onPopoverHide,this,s))):"bodyclick"==a?o("body").add(this.controls.$view).on("mousedown.imgl touchstart.imgl",o.proxy(this.onPopoverHide,this,s)):"leave"==a?(s.$el.on("mouseleave.imgl",o.proxy(this.onHotSpotLeave,this,s)),o("body").add(this.controls.$view).on("touchstart.imgl",o.proxy(this.onPopoverHide,this,s))):"popover"==a?this.popoverClosePopover=!0:"manual"==a&&(this.popoverCloseManual=!0)}}this.controls.$hotspots.append(s.$el),!this.popover||s.popoverLazyload&&!s.popoverShow||this.createPopover(s)}this.hotSpots=this.hotSpots.concat(t)},resetHotSpots:function(){this.controls.$hotspots.children().fadeTo("slow",0,function(){o(this).remove()})},updateHotSpots:function(){var o=this.container.width(),t=this.container.height();0==o||0==t?this.controls.$view.css({display:"none"}):this.controls.$view.css({display:"block"});this.container.get(0).getBoundingClientRect();var i=0,e=0,s=parseInt(this.container.css("margin-top"),10),n=parseInt(this.container.css("margin-left"),10),r=parseInt(this.container.css("padding-top"),10),p=parseInt(this.container.css("padding-left"),10),l=parseInt(this.container.css("border-top-width"),10),a=parseInt(this.container.css("border-left-width"),10);isNaN(r)&&(r=0),isNaN(p)&&(p=0),isNaN(s)&&(s=0),isNaN(n)&&(n=0),isNaN(l)&&(l=0),isNaN(a)&&(a=0),i+=s+r+l,e+=n+p+a,this.controls.$view.css({top:i,left:e,width:o,height:t});for(var h=this.hotSpots.length;h--;){var c=this.hotSpots[h],v=c.$el.width(),d=c.$el.height();e=o*c.x,i=t*c.y,e=Math.round(e-v/2),i=Math.round(i-d/2);c.$el.css({left:e,top:i})}},applyPopoverSupport:function(){if(this.popover=this.config.popover,this.popover){if(1!=o(this.config.popoverTemplate).length)return this.popover=!1,void console.error("'popoverTemplate' option must consist of exactly 1 top-level element!");this.popoverTemplate=this.config.popoverTemplate}},createPopover:function(t){if(!t.$popover){t.$popover=o(this.popoverTemplate);var i=this.getUID("popover");t.$popover.attr("id",i),this.popoverCloseManual&&(t.$popover.addClass("imgl-close"),t.$popover.find(".imgl-close").on("click.imgl",o.proxy(this.onPopoverHide,this,t))),t.$popover.on("click.imgl",o.proxy(this.onPopoverClick,this,t))}var e=t.$popover;if(!e.hasClass("imgl-active")||t.$popover.hasClass(this.config.popoverHideClass)){var s=this.getPopoverContent(t);e.find(".imgl-content").children().detach().end()[t.popoverHtml?"string"==typeof s?"html":"append":"text"](s),e.detach().css({top:-9999,left:-9999,width:""}),e.removeClass(this.config.popoverHideClass),e.removeClass(this.config.popoverShowClass),t.popoverWidth&&e.css({"max-width":t.popoverWidth,"min-width":t.popoverWidth}),this.liftupPopover(t),e.appendTo(this.controls.$view),e.css({width:e[0].offsetWidth})}},showPopover:function(t){if(this.popover&&t.visible&&t.popover&&(t.popoverContent||t.popoverSelector)){this.createPopover(t);var i=this.config.popoverPlacement;t.popoverPlacement&&(i=t.popoverPlacement);var e=this.getPopoverPosition(t),s=t.$popover,n=s[0].offsetWidth,r=s[0].offsetHeight,p=this.getPopoverOffset(i,e,n,r);if(this.applyPopoverPlacement(t,p,i),s.hasClass("imgl-active")||(s.removeClass(this.config.popoverHideClass),s.addClass(this.config.popoverShowClass),this.config.popoverShowClass?(s.css("visibility","visible"),s.addClass("imgl-active").addClass(this.config.popoverShowClass),s.one(this.util().animationEvent(),o.proxy(function(t){var i=o(t.target);i.hasClass(this.config.popoverHideClass)||i.removeClass(this.config.popoverShowClass),i.css("visibility","")},this))):s.addClass("imgl-active")),this.popoverClosePopover)for(var l=0,a=this.hotSpots.length;l<a;l++){var h=this.hotSpots[l];h.id!=t.id&&h.$popover&&h.$popover.hasClass("imgl-active")&&this.hidePopover(h)}}},updatePopovers:function(){for(var o=this.hotSpots.length;o--;){var t=this.hotSpots[o];t.$popover&&t.$popover.hasClass("imgl-active")&&this.showPopover(t)}},showPopovers:function(){for(var o=this.hotSpots.length;o--;){var t=this.hotSpots[o];t.popover&&t.popoverShow&&this.showPopover(t)}},getUID:function(o){do{o+=~~(1e6*Math.random())}while(document.getElementById(o));return o},getPopoverContent:function(t){if(t.popoverContent)return"function"==typeof t.popoverContent?t.popoverContent.call(t):t.popoverContent;if(t.popoverSelector){return o(t.popoverSelector).html()}return""},getPopoverPosition:function(t){var i=t.$el,e=i.get(0).getBoundingClientRect(),s=i.offset(),n=o.extend({},e,s);return n.top=n.top+n.height/2,n.left=n.left+n.width/2,n},getPopoverOffset:function(o,t,i,e){return"bottom"==o?{top:t.top,left:t.left-i/2}:"top"==o?{top:t.top-e,left:t.left-i/2}:"left"==o?{top:t.top-e/2,left:t.left-i}:"right"==o?{top:t.top-e/2,left:t.left}:"bottom-left"==o?{top:t.top,left:t.left-i}:"bottom-right"==o?{top:t.top,left:t.left}:"top-left"==o?{top:t.top-e,left:t.left-i}:"top-right"==o?{top:t.top-e,left:t.left}:{top:t.top-e,left:t.left-i/2}},applyPopoverPlacement:function(t,i,e){var s=t.$popover,n=(s[0].offsetWidth,s[0].offsetHeight,parseInt(s.css("margin-top"),10)),r=parseInt(s.css("margin-left"),10),p=parseInt(s.css("margin-bottom"),10),l=parseInt(s.css("margin-right"),10);isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(p)&&(p=0),isNaN(l)&&(l=0),i.top+=n-p,i.left+=r-l,o.offset.setOffset(s[0],o.extend({using:function(o){s.css({top:Math.round(o.top),left:Math.round(o.left)})}},i),0);for(var a=["top","left","bottom","right","top-left","top-right","bottom-left","bottom-right"],h=a.length;h--;)if(a[h]==e){a.splice(h,1);break}for(h=a.length;h--;)s.removeClass("imgl-popover-"+a[h]);s.addClass("imgl-popover-"+e)},hidePopover:function(t){t.$popover&&(t.$popover.hasClass("imgl-active")||t.$popover.hasClass(this.config.popoverShowClass))&&(t.$popover.removeClass(this.config.popoverShowClass),t.$popover.css("z-index",""),t.$el.css("z-index",""),this.config.popoverHideClass?(t.$popover.addClass(this.config.popoverHideClass),t.$popover.one(this.util().animationEvent(),o.proxy(function(t){var i=o(t.target);i.hasClass(this.config.popoverShowClass)||(i.removeClass(this.config.popoverHideClass),this.retachPopover(i))},this))):this.retachPopover(t.$popover))},retachPopover:function(o){o.removeClass("imgl-active"),o.detach(),o.get(0).offsetHeight,o.appendTo(this.controls.$view),0==this.controls.$view.find(".imgl-popover.imgl-active").length&&(this.controls.$view.find(".imgl-hotspot, .imgl-popover").css("z-index",""),this.zindex=4)},liftupPopover:function(o){(this.hotSpots.length>1||o.popoverShow)&&(this.config.hotSpotBelowPopover?(o.$el.css("z-index",this.zindex+1),o.$popover.css("z-index",this.zindex+2)):(o.$el.css("z-index",this.zindex+2),o.$popover.css("z-index",this.zindex+1)),this.zindex=this.zindex+2)},updateLayout:function(){this.updateHotSpots(),this.updatePopovers()},onAnimationStart:function(o){this.updateLayout()},onLoad:function(t){this.updateLayout(),setTimeout(o.proxy(this.showPopovers,this),400)},onResize:function(o){this.updateLayout()},onHotSpotClick:function(o,t){o.$popover&&o.$popover.hasClass("imgl-active")||t.stopImmediatePropagation(),this.showPopover(o)},onHotSpotEnter:function(o,t){this.showPopover(o)},onHotSpotTouchStart:function(o,t){this.showPopover(o)},onHotSpotTouchEnd:function(t,i){o(i.target).is("a")&&(i.preventDefault(),i.target.click())},onHotSpotLeave:function(t,i){if(t.$popover){var e=i.toElement||i.relatedTarget;0!==t.$popover.has(e).length||t.$popover.is(e)||t.$el.is(e)?t.$popover.one("mouseleave.imgl",o.proxy(this.onHotSpotLeave,this,t)):this.hidePopover(t)}},onPopoverClick:function(o,t){o.$popover&&this.liftupPopover(o)},onPopoverHide:function(t,i){t.$popover&&(0===t.$popover.has(i.target).length||o(i.target).hasClass("imgl-close"))&&(o(i.target).hasClass("imgl-close")&&i.stopImmediatePropagation(),this.hidePopover(t))},onViewClick:function(o){if(this.hotSpotSetup){var t=this.controls.$view.offset(),i=o.pageX-t.left,e=o.pageY-t.top,s=this.controls.$view.get(0).getBoundingClientRect(),n=i/(s.right-s.left),r=e/(s.bottom-s.top);console.log("x:"+n+", y:"+r)}},onViewKeyDown:function(o){o.ctrlKey&&(this.controls.$view.focus(),this.hotSpotSetup=!0)},onViewKeyUp:function(o){this.hotSpotSetup=!1},destroy:function(){this.controls.$main&&(this.resetHotSpots(),this.resetHandlers(),this.resetDOM())},util:function(){return null!=this._util?this._util:this._util=new e}},o.fn.imagelinks=function(t,e){if("instance"==t){var s=o(this).data("imglnks");return s||void console.error("Calling 'instance' method on not initialized instance is forbidden")}return this.each(function(){var e=o(this),s=e.data("imglnks"),n=o.isPlainObject(t)?t:{};if("destroy"==t)return s||console.error("Calling 'destroy' method on not initialized instance is forbidden"),e.removeData("imglnks"),void s.destroy();if("resize"==t)return s||console.error("Calling 'resize' method on not initialized instance is forbidden"),void this.updateLayout();if(s){var r=o.extend({},s.config,n);s.init(e,r)}else{s=new i(e,r=o.extend({},i.prototype.defaults,n)),e.data("imglnks",s)}})}}(window.jQuery);